name: code-quality
on: [push]
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checks-out the repository
        uses: actions/checkout@v3

      - name: Setup java runtime
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'adopt'

      - name: Run spotlessCheck
        run: ./gradlew clean spotlessCheck

      - name: Run spotbugsMain
        run: ./gradlew clean spotbugsMain

      - name: Run spotbugsTest
        run: ./gradlew clean spotbugsTest

      - name: Run checkstyleMain
        run: ./gradlew clean checkstyleMain

      - name: Run checkstyleTest
        run: ./gradlew clean checkstyleTest

      - name: Run pmdMain
        run: ./gradlew clean pmdMain

      - name: Run dependencyCheckAnalyze only if build.gradle file has been modified
        uses: dorny/paths-filter@v2
        id: changes
        with:
          filters: |
            build_gradle:
              - 'build.gradle'
      - if: steps.changes.outputs.build_gradle == 'true'
        run: ./gradlew dependencyCheckAnalyze
